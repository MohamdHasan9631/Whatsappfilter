# إعداد فحص الواتساب الحقيقي - WppConnect Setup

## نظرة عامة

تم تطوير المشروع ليتضمن فحص أرقام الواتساب الحقيقي باستخدام مكتبة [wppconnect](https://wppconnect.io/)، والتي تتيح الاتصال بواتساب ويب والتحقق من صحة الأرقام بشكل حقيقي.

## المتطلبات

- Node.js 14+ 
- متصفح Chrome أو Chromium
- اتصال مستقر بالإنترنت
- هاتف يحتوي على واتساب مفعل

## التشغيل

### 1. تثبيت التبعيات
```bash
npm install
```

### 2. تشغيل الخادم
```bash
npm start
```

سيتم تشغيل الخادم على المنفذ 3000 والموقع على: `http://localhost:3000`

### 3. ربط حساب الواتساب

عند بدء التشغيل لأول مرة، ستحتاج إلى ربط حساب الواتساب:

1. افتح الموقع في المتصفح
2. ستظهر حالة "جاري الاتصال..." في البداية
3. عندما تصبح الحالة "اضغط لعرض رمز QR"، اضغط عليها
4. ستظهر نافذة تحتوي على رمز QR
5. افتح واتساب على هاتفك
6. اذهب إلى القائمة (النقاط الثلاث) > الأجهزة المرتبطة
7. اضغط على "ربط جهاز"
8. امسح رمز QR المعروض
9. بعد المسح بنجاح، ستصبح الحالة "متصل - جاهز للفحص"

## الميزات الجديدة

### فحص حقيقي للواتساب
- التحقق الفعلي من وجود الرقم على واتساب
- الحصول على صورة الملف الشخصي (إن وجدت)
- التحقق من نوع الحساب (شخصي/تجاري)
- عرض اسم المستخدم (إن كان محفوظاً في جهات الاتصال)

### واجهة برمجة التطبيقات (API)

#### GET /api/status
إرجاع حالة الاتصال الحالية:
```json
{
  "status": "connected|qr_ready|disconnected|initializing",
  "qrCode": "base64_image_or_null",
  "connected": true/false
}
```

#### POST /api/check-whatsapp
فحص رقم واحد:
```json
{
  "number": "+962791234567"
}
```

#### POST /api/check-whatsapp-bulk
فحص أرقام متعددة:
```json
{
  "numbers": ["+962791234567", "+966501234567"]
}
```

#### POST /api/restart
إعادة تشغيل عميل الواتساب

## حالات الاتصال

- **connecting/initializing**: جاري تهيئة الاتصال
- **qr_ready**: جاهز لعرض رمز QR للمسح
- **connected**: متصل وجاهز للاستخدام
- **disconnected**: غير متصل
- **error**: خطأ في الاتصال

## استكشاف الأخطاء

### المشكلة: "عميل الواتساب غير متصل"
**الحل**: تأكد من أن حالة الاتصال "متصل". إذا لم تكن كذلك، امسح رمز QR مرة أخرى.

### المشكلة: "فشل في تحديث رمز QR"
**الحل**: اضغط على "إعادة المحاولة" في نافذة QR أو أعد تشغيل الخادم.

### المشكلة: بطء في الفحص
**الحل**: الفحص الحقيقي يستغرق وقتاً أطول من المحاكاة. انتظر بضع ثوانٍ لكل رقم.

## الأمان

- لا تشارك رمز QR مع أي شخص آخر
- تأكد من استخدام الأداة فقط للأرقام التي تملك الإذن لفحصها
- احترم خصوصية المستخدمين وقوانين الاستخدام

## ملاحظات مهمة

1. **معدل الطلبات**: للحفاظ على استقرار الاتصال، يتم إضافة تأخير بين طلبات الفحص
2. **حفظ الجلسة**: يتم حفظ جلسة الواتساب تلقائياً في مجلد `tokens/`
3. **إعادة الاتصال**: في حالة انقطاع الاتصال، استخدم زر "إعادة المحاولة"

## الدعم

للمشاكل التقنية، يرجى فتح issue على GitHub أو مراجعة:
- [وثائق wppconnect](https://wppconnect.io/docs/)
- [مصادر wppconnect على GitHub](https://github.com/wppconnect-team/wppconnect)